---
name: Email Service Integration and Templates
status: open
created: 2026-01-06T08:26:55Z
updated: 2026-01-06T08:26:55Z
github: [Will be updated when synced to GitHub]
depends_on: []
parallel: true
conflicts_with: []
---

# Task: Email Service Integration and Templates

## Description

Set up email service (SendGrid or Mailgun) and create all email templates required for authentication flows including email verification, password reset, password change confirmation, and account lockout alerts. Ensure emails are mobile-friendly and have high deliverability.

## Acceptance Criteria

- [ ] Email service account set up (SendGrid or Mailgun)
- [ ] Sender email address verified (noreply@solidseed.app)
- [ ] SPF and DKIM records configured for domain
- [ ] Email verification template created
- [ ] Password reset template created
- [ ] Password changed confirmation template created
- [ ] Account lockout alert template created
- [ ] Email sending service implemented with retry logic
- [ ] Email deliverability > 95% to inbox (tested)
- [ ] Emails render correctly on mobile devices
- [ ] Email tracking configured (delivery status, opens)

## Technical Details

**Email Service Setup:**

1. Choose provider: SendGrid (recommended) or Mailgun
2. Create account and verify domain
3. Configure SPF record: `v=spf1 include:sendgrid.net ~all`
4. Configure DKIM record (provided by SendGrid/Mailgun)
5. Verify sender address: noreply@solidseed.app
6. Obtain API key

**Email Templates:**

**1. Email Verification (Welcome)**

```html
Subject: Verify your SolidSeed account Hi {{user_name}}, Welcome to SolidSeed! Please verify your email
address to activate your account. [Verify Email Button] {{verification_link}} This link will expire
in 24 hours. If you didn't create a SolidSeed account, please ignore this email. Thanks, The SolidSeed
Team
```

**2. Password Reset Request**

```html
Subject: Reset your SolidSeed password Hi {{user_name}}, We received a request to reset your password
for your SolidSeed account. [Reset Password Button] {{reset_link}} This link will expire in 1 hour. If
you didn't request a password reset, please ignore this email or contact support if you have
concerns. Thanks, The SolidSeed Team
```

**3. Password Changed Confirmation**

```html
Subject: Your SolidSeed password was changed Hi {{user_name}}, Your SolidSeed account password was
successfully changed. If you made this change, no further action is needed. If you didn't change
your password, please contact our support team immediately at support@solidseed.app. Thanks, The
SolidSeed Team
```

**4. Account Lockout Alert**

```html
Subject: Security alert: Your SolidSeed account was locked Hi {{user_name}}, We detected multiple
failed login attempts on your SolidSeed account. To protect your account, we've temporarily locked it
for 30 minutes. Your account will automatically unlock at {{unlock_time}}. If this wasn't you, we
recommend resetting your password immediately: [Reset Password Button] {{reset_link}} If you have
any concerns, contact our support team at support@solidseed.app. Thanks, The SolidSeed Team
```

**Email Service Implementation:**

```typescript
// services/email.service.ts
import sendgrid from '@sendgrid/mail';

export class EmailService {
  constructor() {
    sendgrid.setApiKey(process.env.SENDGRID_API_KEY);
  }

  async sendVerificationEmail(to: string, name: string, token: string) {
    const verificationLink = `${process.env.APP_URL}/verify-email?token=${token}`;

    await this.sendEmail({
      to,
      template: 'email-verification',
      variables: {
        user_name: name,
        verification_link: verificationLink,
      },
    });
  }

  async sendPasswordResetEmail(to: string, name: string, token: string) {
    const resetLink = `${process.env.APP_URL}/reset-password?token=${token}`;

    await this.sendEmail({
      to,
      template: 'password-reset',
      variables: {
        user_name: name,
        reset_link: resetLink,
      },
    });
  }

  async sendPasswordChangedEmail(to: string, name: string) {
    await this.sendEmail({
      to,
      template: 'password-changed',
      variables: {
        user_name: name,
      },
    });
  }

  async sendAccountLockoutEmail(to: string, name: string, unlockTime: Date, resetToken: string) {
    const resetLink = `${process.env.APP_URL}/reset-password?token=${resetToken}`;

    await this.sendEmail({
      to,
      template: 'account-lockout',
      variables: {
        user_name: name,
        unlock_time: unlockTime.toLocaleString(),
        reset_link: resetLink,
      },
    });
  }

  private async sendEmail(params: EmailParams) {
    try {
      await sendgrid.send({
        from: 'noreply@solidseed.app',
        to: params.to,
        templateId: this.getTemplateId(params.template),
        dynamicTemplateData: params.variables,
      });
    } catch (error) {
      // Log error and retry
      console.error('Email send failed:', error);
      // Implement retry logic (e.g., queue for retry)
      throw error;
    }
  }

  private getTemplateId(template: string): string {
    const templates = {
      'email-verification': process.env.SENDGRID_TEMPLATE_EMAIL_VERIFICATION,
      'password-reset': process.env.SENDGRID_TEMPLATE_PASSWORD_RESET,
      'password-changed': process.env.SENDGRID_TEMPLATE_PASSWORD_CHANGED,
      'account-lockout': process.env.SENDGRID_TEMPLATE_ACCOUNT_LOCKOUT,
    };
    return templates[template];
  }
}
```

**Template Design Requirements:**

- Mobile-responsive (renders well on 320px+ width)
- Branded with SolidSeed logo and colors
- Clear call-to-action buttons
- Plain text alternative (for email clients that don't support HTML)
- Unsubscribe link (for marketing compliance)

**Files to Create:**

- `services/email.service.ts` - Email sending logic
- `templates/emails/verification.html` - Email verification template
- `templates/emails/password-reset.html` - Password reset template
- `templates/emails/password-changed.html` - Password changed template
- `templates/emails/account-lockout.html` - Account lockout template
- `config/email.config.ts` - Email configuration
- `.env.example` - Add email service env vars

**Environment Variables:**

- SENDGRID_API_KEY (or MAILGUN_API_KEY)
- SENDGRID_TEMPLATE_EMAIL_VERIFICATION
- SENDGRID_TEMPLATE_PASSWORD_RESET
- SENDGRID_TEMPLATE_PASSWORD_CHANGED
- SENDGRID_TEMPLATE_ACCOUNT_LOCKOUT
- EMAIL_FROM_ADDRESS=noreply@solidseed.app

## Dependencies

- [ ] Domain ownership verified
- [ ] Email service account created
- [ ] Design assets for email templates (logo, brand colors)

## Effort Estimate

- Size: M
- Hours: 8-12 hours
- Parallel: true (independent of other tasks)

## Definition of Done

- [ ] Email service configured and tested
- [ ] Domain verified with SPF and DKIM
- [ ] All 4 email templates created and uploaded
- [ ] Email sending service implemented
- [ ] Retry logic for failed sends
- [ ] Test emails sent and verified in inbox
- [ ] Templates tested on multiple email clients (Gmail, Outlook, Apple Mail)
- [ ] Mobile rendering tested
- [ ] Deliverability rate verified > 95%
- [ ] Email tracking configured
- [ ] Documentation for email service setup
- [ ] Code reviewed and merged
