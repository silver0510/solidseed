---
name: OAuth Provider Registration and Setup
status: open
created: 2026-01-06T08:26:55Z
updated: 2026-01-06T08:26:55Z
github: [Will be updated when synced to GitHub]
depends_on: []
parallel: true
conflicts_with: []
---

# Task: OAuth Provider Registration and Setup

## Description

Register OAuth applications with Google Cloud Platform and Microsoft Azure AD, configure redirect URIs, obtain client credentials, and verify OAuth flows work correctly. This is a prerequisite for OAuth integration testing.

## Acceptance Criteria

- [ ] Google Cloud Platform project created
- [ ] Google OAuth 2.0 Client ID created and configured
- [ ] Google OAuth consent screen configured
- [ ] Google redirect URIs set up correctly
- [ ] Microsoft Azure AD app registration created
- [ ] Microsoft OAuth client secret generated
- [ ] Microsoft API permissions configured (email, profile)
- [ ] Microsoft redirect URIs set up correctly
- [ ] All OAuth credentials stored securely in environment variables
- [ ] OAuth flows tested manually with both providers
- [ ] Documentation created for OAuth setup process

## Technical Details

**Google Cloud Platform Setup:**

1. **Create GCP Project**
   - Go to Google Cloud Console
   - Create new project: "Korella CRM"
   - Enable Google+ API

2. **Create OAuth 2.0 Client ID**
   - Navigate to APIs & Services → Credentials
   - Click "Create Credentials" → "OAuth 2.0 Client ID"
   - Application type: Web application
   - Name: "Korella Web App"

3. **Configure OAuth Consent Screen**
   - User type: External
   - App name: "Korella CRM"
   - App logo: Upload Korella logo
   - Support email: support@korella.com
   - Scopes: email, profile
   - Test users: Add development team emails

4. **Set Authorized Redirect URIs**
   - Development: `http://localhost:3000/api/auth/oauth/google/callback`
   - Staging: `https://staging.korella.com/api/auth/oauth/google/callback`
   - Production: `https://app.korella.com/api/auth/oauth/google/callback`

5. **Obtain Credentials**
   - Client ID: Copy to `GOOGLE_CLIENT_ID` env var
   - Client Secret: Copy to `GOOGLE_CLIENT_SECRET` env var

**Microsoft Azure AD Setup:**

1. **Register Application**
   - Go to Azure Portal → Azure Active Directory
   - App registrations → New registration
   - Name: "Korella CRM"
   - Supported account types: "Accounts in any organizational directory and personal Microsoft accounts"

2. **Configure Redirect URIs**
   - Platform: Web
   - Redirect URIs:
     - Development: `http://localhost:3000/api/auth/oauth/microsoft/callback`
     - Staging: `https://staging.korella.com/api/auth/oauth/microsoft/callback`
     - Production: `https://app.korella.com/api/auth/oauth/microsoft/callback`

3. **Add API Permissions**
   - Microsoft Graph → Delegated permissions
   - Add: `email`, `profile`, `openid`, `User.Read`
   - Grant admin consent

4. **Generate Client Secret**
   - Certificates & secrets → New client secret
   - Description: "Korella Web App Secret"
   - Expires: 24 months
   - Copy value to `MICROSOFT_CLIENT_SECRET` env var

5. **Obtain Application ID**
   - Copy Application (client) ID to `MICROSOFT_CLIENT_ID` env var

**Testing OAuth Flows:**

1. **Manual Test - Google OAuth:**
   - Start local development server
   - Navigate to `/api/auth/oauth/google`
   - Should redirect to Google consent screen
   - Log in with test Google account
   - Should redirect back to app with user data
   - Verify user created in database
   - Verify JWT token generated

2. **Manual Test - Microsoft OAuth:**
   - Navigate to `/api/auth/oauth/microsoft`
   - Should redirect to Microsoft login
   - Log in with test Microsoft account
   - Should redirect back to app with user data
   - Verify user created in database
   - Verify JWT token generated

**Security Considerations:**

- Never commit client secrets to version control
- Use different OAuth apps for each environment (dev, staging, prod)
- Rotate client secrets periodically (every 6-12 months)
- Monitor OAuth usage for suspicious activity

**Documentation to Create:**

`docs/oauth-setup.md`:

```markdown
# OAuth Provider Setup Guide

## Google OAuth Setup

1. Create GCP project
2. Enable Google+ API
3. Create OAuth 2.0 Client ID
4. Configure consent screen
5. Add redirect URIs
6. Copy credentials to .env

## Microsoft OAuth Setup

1. Register Azure AD app
2. Configure redirect URIs
3. Add API permissions
4. Generate client secret
5. Copy credentials to .env

## Environment Variables

GOOGLE_CLIENT_ID=your_google_client_id
GOOGLE_CLIENT_SECRET=your_google_client_secret
MICROSOFT_CLIENT_ID=your_microsoft_app_id
MICROSOFT_CLIENT_SECRET=your_microsoft_client_secret

## Testing

1. Run local dev server
2. Navigate to /api/auth/oauth/google
3. Complete OAuth flow
4. Verify user created in database
```

**Files to Create/Update:**

- `docs/oauth-setup.md` - Step-by-step setup guide
- `.env.example` - Add OAuth env vars
- `README.md` - Link to OAuth setup guide
- `config/oauth-credentials.json` (gitignored) - Store credentials locally for dev

**Environment Variables:**

```bash
# Google OAuth
GOOGLE_CLIENT_ID=xxx.apps.googleusercontent.com
GOOGLE_CLIENT_SECRET=xxx

# Microsoft OAuth
MICROSOFT_CLIENT_ID=xxx
MICROSOFT_CLIENT_SECRET=xxx

# Redirect URIs
APP_URL=http://localhost:3000  # or staging/production URL
```

## Dependencies

- [ ] Domain verified and SSL certificate obtained
- [ ] Google account with Cloud Console access
- [ ] Microsoft account with Azure Portal access
- [ ] Korella logo and branding assets

## Effort Estimate

- Size: S
- Hours: 4-6 hours
- Parallel: true (can be done independently)

## Definition of Done

- [ ] Google OAuth app created and configured
- [ ] Microsoft OAuth app created and configured
- [ ] All redirect URIs set for all environments
- [ ] Credentials obtained and stored securely
- [ ] OAuth consent screens configured with branding
- [ ] Manual testing completed for both providers
- [ ] Documentation created for setup process
- [ ] Environment variables added to .env.example
- [ ] Credentials added to development environment
- [ ] Credentials added to staging environment
- [ ] Credentials added to production environment (when ready)
- [ ] Screenshots added to documentation
- [ ] Peer review completed
