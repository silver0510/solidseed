---
name: Better Auth Library Integration and Configuration
status: open
created: 2026-01-06T08:26:55Z
updated: 2026-01-06T08:58:07Z
github: [Will be updated when synced to GitHub]
depends_on: [001]
parallel: false
conflicts_with: []
---

# Task: Better Auth Library Integration and Configuration

## Description

Install and configure Better Auth library with Supabase PostgreSQL adapter, supporting OAuth (Google, Microsoft), email verification, JWT tokens, password hashing, and rate limiting. Set up the core authentication framework that all other auth features will build upon.

## Acceptance Criteria

- [ ] Better Auth library installed and dependencies resolved
- [ ] Supabase PostgreSQL adapter configured and connected to database
- [ ] OAuth providers configured (Google and Microsoft with client IDs/secrets)
- [ ] Email verification enabled with 24-hour token expiration
- [ ] JWT configuration set up (3-day default, secret key, signing algorithm)
- [ ] Password hashing configured (bcrypt with cost factor 12)
- [ ] Password complexity rules enforced (8+ chars, upper, lower, number, symbol)
- [ ] Rate limiting configured (10 login attempts/min per IP, 3 password resets/hr per email)
- [ ] Better Auth middleware integrated into application
- [ ] Configuration documented with all environment variables listed

## Technical Details

**Better Auth Configuration File: `config/better-auth.config.ts`**

```typescript
export const authConfig = {
  database: {
    adapter: postgresAdapter({
      connectionString: process.env.SUPABASE_DATABASE_URL,
    }),
  },

  emailVerification: {
    enabled: true,
    tokenExpiration: 24 * 60 * 60, // 24 hours in seconds
    sendVerificationEmail: true,
  },

  oauth: {
    google: {
      clientId: process.env.GOOGLE_CLIENT_ID,
      clientSecret: process.env.GOOGLE_CLIENT_SECRET,
      redirectUri: `${process.env.APP_URL}/api/auth/oauth/google/callback`,
      scopes: ['email', 'profile'],
    },
    microsoft: {
      clientId: process.env.MICROSOFT_CLIENT_ID,
      clientSecret: process.env.MICROSOFT_CLIENT_SECRET,
      redirectUri: `${process.env.APP_URL}/api/auth/oauth/microsoft/callback`,
      scopes: ['email', 'profile'],
    },
  },

  session: {
    jwt: {
      secret: process.env.JWT_SECRET,
      expiresIn: '3d', // 3 days default
      algorithm: 'HS256',
    },
  },

  password: {
    bcrypt: {
      saltRounds: 12,
    },
    complexity: {
      minLength: 8,
      requireUppercase: true,
      requireLowercase: true,
      requireNumber: true,
      requireSymbol: true,
    },
  },

  rateLimit: {
    login: {
      max: 10,
      window: 60, // 10 requests per 60 seconds
    },
    passwordReset: {
      max: 3,
      window: 3600, // 3 requests per hour
    },
  },
};
```

**Environment Variables Required:**

- SUPABASE_URL (https://your-project.supabase.co)
- SUPABASE_ANON_KEY (public anonymous key)
- SUPABASE_DATABASE_URL (PostgreSQL connection string)
- GOOGLE_CLIENT_ID
- GOOGLE_CLIENT_SECRET
- MICROSOFT_CLIENT_ID
- MICROSOFT_CLIENT_SECRET
- JWT_SECRET (256-bit secure random key)
- APP_URL

**Files to Create/Modify:**

- `config/better-auth.config.ts` - Main configuration
- `middleware/auth.ts` - Better Auth middleware setup
- `.env.example` - Document all required environment variables
- `README.md` - Add Better Auth setup instructions

## Dependencies

- [ ] Task 001 completed (database schema exists)
- [ ] OAuth client IDs registered (Google Cloud, Azure AD)
- [ ] JWT secret key generated
- [ ] Environment variables configured

## Effort Estimate

- Size: M
- Hours: 8-12 hours
- Parallel: false (depends on database schema)

## Definition of Done

- [ ] Better Auth installed and configured
- [ ] All OAuth providers working in test environment
- [ ] Email verification configured
- [ ] JWT tokens generating successfully
- [ ] Password hashing verified (bcrypt cost 12)
- [ ] Rate limiting tested and working
- [ ] Configuration tested with all settings
- [ ] Environment variables documented
- [ ] Code reviewed and merged
