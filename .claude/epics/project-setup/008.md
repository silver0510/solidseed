---
name: setup-vercel-cli
status: closed
created: 2026-01-07T02:57:01Z
updated: 2026-01-08T02:57:08Z
github: null
depends_on: [001]
parallel: true
conflicts_with: []
---

# Task: Set up Vercel CLI and link project

## Description

Install Vercel CLI globally, create a Vercel account, link the project for deployments, test the local development environment with Vercel, and document the deployment process without actually deploying to production yet.

## Acceptance Criteria

- [ ] Vercel CLI installed globally
- [ ] Vercel account created and authenticated
- [ ] Project linked with `vercel link`
- [ ] `vercel dev` tested and working
- [ ] Project settings configured (environment variables preparation)
- [ ] Deployment process documented in README
- [ ] Production deployment checklist created
- [ ] Vercel configuration file created (vercel.json)

## Technical Details

### Implementation Steps

**1. Install Vercel CLI**

```bash
# Install globally
npm install -g vercel

# Verify installation
vercel --version
# Should show: Vercel CLI 33.0.0 or higher

# Alternative: use npx (no global install)
npx vercel --version
```

**2. Create Vercel Account and Authenticate**

```bash
# Login to Vercel
vercel login

# Choose login method:
# - GitHub (recommended)
# - GitLab
# - Bitbucket
# - Email

# Follow browser authentication flow
# After success, you'll see:
# > Success! GitHub authentication complete for your-email@example.com

# Verify authentication
vercel whoami
# Should show your username
```

**3. Link Project to Vercel**

```bash
# From project root
vercel link

# Answer the prompts:
# ? Set up and deploy "~/path/to/Korella"? [Y/n] y
# ? Which scope do you want to deploy to? Your Personal Account
# ? Link to existing project? [y/N] n
# ? What's your project's name? korella-crm
# ? In which directory is your code located? ./

# This creates .vercel directory with project configuration
# .vercel/
#   project.json  - Contains project ID and org ID
```

**4. Create Vercel Configuration**

```json
// vercel.json
{
  "buildCommand": "npm run build",
  "devCommand": "npm run dev",
  "installCommand": "npm install",
  "framework": "nextjs",
  "regions": ["iad1"],
  "env": {
    "NEXT_PUBLIC_APP_URL": "https://korella.app"
  },
  "build": {
    "env": {
      "NEXT_TELEMETRY_DISABLED": "1"
    }
  },
  "headers": [
    {
      "source": "/(.*)",
      "headers": [
        {
          "key": "X-Content-Type-Options",
          "value": "nosniff"
        },
        {
          "key": "X-Frame-Options",
          "value": "DENY"
        },
        {
          "key": "X-XSS-Protection",
          "value": "1; mode=block"
        }
      ]
    }
  ],
  "redirects": [
    {
      "source": "/home",
      "destination": "/",
      "permanent": true
    }
  ]
}
```

**5. Test Vercel Dev Environment**

```bash
# Start development server with Vercel
vercel dev

# This will:
# - Install dependencies if needed
# - Load environment variables from Vercel (if configured)
# - Start Next.js dev server
# - Enable Vercel-specific features

# Test in browser
# http://localhost:3000

# Verify it works the same as `npm run dev`

# Stop server: Ctrl+C
```

**6. Configure Environment Variables in Vercel (Don't Upload Secrets Yet)**

```bash
# List current environment variables
vercel env ls

# We'll add them later in Task 009
# For now, just document what needs to be added:

# Production environment variables needed:
# - DATABASE_URL (Supabase production)
# - SUPABASE_URL
# - SUPABASE_ANON_KEY
# - GOOGLE_CLIENT_ID
# - GOOGLE_CLIENT_SECRET
# - RESEND_API_KEY
# - SENTRY_DSN
# - NEXT_PUBLIC_SENTRY_DSN
# - SENTRY_AUTH_TOKEN
# - JWT_SECRET
# - APP_URL
```

**7. Update .gitignore**

```bash
# Add Vercel files to .gitignore
cat >> .gitignore << 'EOF'

# Vercel
.vercel
EOF
```

**8. Create Deployment Documentation**

````markdown
# Add to README.md

## Vercel Deployment

### Prerequisites

- Vercel account (sign up at vercel.com)
- Vercel CLI installed: `npm install -g vercel`
- Project linked: `vercel link`

### Development with Vercel

```bash
# Start local dev server with Vercel features
vercel dev

# This provides:
# - Environment variables from Vercel
# - Serverless function simulation
# - Edge function testing
```
````

### Deployment Process

#### First Time Setup

1. **Install Vercel CLI**

   ```bash
   npm install -g vercel
   ```

2. **Authenticate**

   ```bash
   vercel login
   ```

3. **Link Project**

   ```bash
   vercel link
   # Follow prompts to create/link project
   ```

4. **Configure Environment Variables**

   ```bash
   # Add production environment variables
   vercel env add DATABASE_URL production
   vercel env add SUPABASE_URL production
   vercel env add SUPABASE_ANON_KEY production
   vercel env add GOOGLE_CLIENT_ID production
   vercel env add GOOGLE_CLIENT_SECRET production
   vercel env add RESEND_API_KEY production
   vercel env add SENTRY_DSN production
   vercel env add NEXT_PUBLIC_SENTRY_DSN production
   vercel env add JWT_SECRET production
   vercel env add APP_URL production

   # Set APP_URL to: https://korella.app
   ```

#### Deploy to Preview

```bash
# Deploy to preview environment
vercel

# This creates a preview deployment with unique URL
# Perfect for testing before production
```

#### Deploy to Production

```bash
# Deploy to production
vercel --prod

# Or use GitHub integration for automatic deployments:
# 1. Go to vercel.com/dashboard
# 2. Import Git Repository
# 3. Connect to GitHub repo
# 4. Configure build settings
# 5. Add environment variables
# 6. Every push to main = automatic production deployment
# 7. Every PR = preview deployment
```

### Vercel Configuration

Project settings are in `vercel.json`:

- Framework: Next.js
- Region: Washington D.C. (iad1) - Closest to US East Coast
- Build command: `npm run build`
- Install command: `npm install`
- Output directory: `.next` (automatic)

### Environment Variables

**Production variables** (set in Vercel dashboard or CLI):

- All variables from `.env.local`
- `APP_URL` = `https://korella.app`
- `NODE_ENV` = `production` (automatic)

**Preview variables** (optional):

- Same as production, but with preview URLs
- Use preview database/services if needed

### Deployment Checklist

Before deploying to production:

- [ ] All environment variables configured in Vercel
- [ ] Database migrations applied to production database
- [ ] Supabase production project configured
- [ ] OAuth redirect URIs updated for production domain
- [ ] Domain configured in Vercel (korella.app)
- [ ] DNS records pointed to Vercel
- [ ] SSL certificate verified
- [ ] Sentry configured for production
- [ ] Error monitoring tested
- [ ] Performance monitoring enabled
- [ ] Build successful locally: `npm run build`
- [ ] Type check passing: `npm run type-check`
- [ ] Tests passing: `npm run test`

### Post-Deployment

1. **Verify deployment**

   ```bash
   vercel ls
   # Check deployment status
   ```

2. **Check logs**

   ```bash
   vercel logs
   # View production logs
   ```

3. **Test production site**
   - Visit https://korella.app
   - Test authentication flow
   - Test database connectivity
   - Verify OAuth works
   - Check Sentry error tracking

### Rollback

If something goes wrong:

```bash
# List deployments
vercel ls

# Promote previous deployment to production
vercel promote <deployment-url>
```

### Useful Commands

```bash
# View project info
vercel inspect

# View logs
vercel logs [deployment-url]

# List all deployments
vercel ls

# Remove deployment
vercel rm [deployment-url]

# Pull environment variables to local
vercel env pull .env.local
```

### GitHub Integration (Recommended)

For automatic deployments:

1. Go to [Vercel Dashboard](https://vercel.com/dashboard)
2. Import Git Repository
3. Select GitHub repository
4. Configure:
   - Framework: Next.js (auto-detected)
   - Root Directory: `./`
   - Build Command: `npm run build`
   - Install Command: `npm install`
5. Add environment variables
6. Deploy

**Automatic Deployments:**

- Push to `main` → Production deployment
- Open PR → Preview deployment
- Commit to PR → Updated preview

### Troubleshooting

**Build fails on Vercel but works locally**

- Check Node.js version matches (use `.nvmrc`)
- Verify all dependencies in `package.json`
- Check environment variables are set
- Review build logs in Vercel dashboard

**Environment variables not loading**

- Ensure variables are set for correct environment (production/preview)
- Restart deployment after adding variables
- Check variable names match exactly

**Domain not working**

- Verify DNS records point to Vercel
- Check domain configuration in Vercel dashboard
- Wait for DNS propagation (up to 48 hours)

**Serverless function timeout**

- Default timeout: 10s (Hobby), 60s (Pro)
- Optimize slow functions
- Consider upgrading plan if needed

````

**9. Create Production Deployment Checklist**
```markdown
# Create DEPLOYMENT.md

# Deployment Checklist

## Pre-Deployment

### Code Quality
- [ ] All tests passing: `npm run test`
- [ ] Type check passing: `npm run type-check`
- [ ] Linting passing: `npm run lint`
- [ ] Build successful: `npm run build`
- [ ] No console errors/warnings

### Environment Setup
- [ ] Production environment variables configured in Vercel
- [ ] Supabase production project created
- [ ] Production database URL set
- [ ] OAuth credentials updated for production domain
- [ ] Resend domain verified
- [ ] Sentry production project configured

### Database
- [ ] All migrations applied to production
- [ ] Database backup created
- [ ] RLS policies verified
- [ ] Indexes created
- [ ] Connection pooling configured

### Third-Party Services
- [ ] Google OAuth redirect URIs include production domain
- [ ] Resend domain verified and active
- [ ] Sentry DSN configured for production
- [ ] Supabase Storage buckets created
- [ ] API rate limits configured

### DNS & Domain
- [ ] Domain purchased (korella.app)
- [ ] Domain added to Vercel
- [ ] DNS records configured
- [ ] SSL certificate verified
- [ ] Redirects configured (www → apex)

## Deployment

### Deploy to Preview First
```bash
# Deploy to preview
vercel

# Test preview deployment thoroughly
# Visit preview URL and test all features
````

### Deploy to Production

```bash
# Deploy to production
vercel --prod

# Or use GitHub integration:
# Merge to main branch → automatic deployment
```

## Post-Deployment

### Verification

- [ ] Site loads: https://korella.app
- [ ] Authentication works (email/password)
- [ ] OAuth works (Google)
- [ ] Database reads/writes working
- [ ] File uploads working
- [ ] Email sending working
- [ ] Error tracking in Sentry

### Monitoring

- [ ] Sentry receiving errors
- [ ] Analytics configured (if any)
- [ ] Performance monitoring enabled
- [ ] Logs accessible in Vercel dashboard

### Security

- [ ] HTTPS working correctly
- [ ] Security headers present (check vercel.json)
- [ ] API routes protected
- [ ] RLS policies active
- [ ] Rate limiting working

## Rollback Plan

If deployment fails:

```bash
# List deployments
vercel ls

# Promote previous deployment
vercel promote <previous-deployment-url>
```

## Support Contacts

- Vercel Support: vercel.com/support
- Supabase Support: supabase.com/support
- Sentry Support: sentry.io/support

````

### Key Files Created/Modified
- `.vercel/project.json` - Vercel project configuration (auto-generated)
- `vercel.json` - Vercel deployment configuration
- `.gitignore` - Add .vercel directory
- `README.md` - Add Vercel deployment documentation
- `DEPLOYMENT.md` - Production deployment checklist

## Dependencies

### Depends On
- Task 001: Project must be initialized with package.json

### Blocks
- Task 009: Deployment readiness verification
- Task 010: Final integration testing may use Vercel preview deployments

## Effort Estimate
- **Size**: S
- **Hours**: 1-1.5 hours
- **Parallel**: true (can work alongside other setup tasks)

## Definition of Done
- [x] Vercel CLI installed and working
- [x] Account created and authenticated
- [x] Project linked successfully
- [x] `vercel dev` tested
- [x] vercel.json configuration created
- [x] Deployment documentation complete
- [x] Production checklist created
- [x] .gitignore updated

## Validation Commands
```bash
# Verify Vercel CLI installed
vercel --version
# Expected: Vercel CLI 33.x.x or higher

# Verify authentication
vercel whoami
# Expected: your-username

# Verify project linked
ls .vercel/project.json
# Expected: file exists

# Test Vercel dev
vercel dev
# Expected: Server starts on http://localhost:3000
# Stop with Ctrl+C

# Check vercel.json exists
cat vercel.json
# Expected: valid JSON configuration

# Verify .gitignore includes Vercel
grep -q "\.vercel" .gitignore
if [ $? -eq 0 ]; then
  echo "✅ .vercel in .gitignore"
else
  echo "❌ Missing .vercel in .gitignore"
fi

# Check documentation
grep -q "Vercel Deployment" README.md
if [ $? -eq 0 ]; then
  echo "✅ Vercel documentation in README"
else
  echo "❌ Missing Vercel documentation"
fi
````

## Troubleshooting

**Issue: "Command 'vercel' not found"**

- Install globally: `npm install -g vercel`
- Or use npx: `npx vercel`
- Check npm global bin path: `npm config get prefix`

**Issue: "No existing credentials found"**

- Run `vercel login` to authenticate
- Choose authentication method (GitHub recommended)
- Complete browser OAuth flow

**Issue: "Error: Project not linked"**

- Run `vercel link` from project root
- Follow prompts to create/link project
- Verify `.vercel/project.json` was created

**Issue: "vercel dev" fails to start**

- Check port 3000 is available
- Try different port: `vercel dev --listen 3001`
- Check package.json has valid scripts
- Ensure dependencies installed: `npm install`

**Issue: "Build fails on Vercel but works locally"**

- Check Node.js version matches
- Add `.nvmrc` file with Node version
- Verify all dependencies in package.json
- Check for missing environment variables

## Next Steps

After completing this task:

1. Configure production environment variables (in Task 009)
2. Set up custom domain (korella.app)
3. Configure DNS records
4. Test preview deployments
5. Set up GitHub integration for automatic deployments
6. Configure deployment notifications (Slack, email)
7. Plan production deployment (after all tasks complete)
