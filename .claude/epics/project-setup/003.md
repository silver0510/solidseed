---
name: Configure development tooling and code quality
status: open
created: 2026-01-07T02:57:01Z
updated: 2026-01-07T02:57:01Z
github: null
depends_on: [001, 002]
parallel: false
conflicts_with: []
---

# Task: Configure Development Tooling and Code Quality

## Description

Set up comprehensive development tooling including PWA configuration, test frameworks (Vitest and Playwright), and enhanced code quality tools. This task prepares the development environment for efficient feature development with proper testing infrastructure.

## Acceptance Criteria

- [ ] PWA configuration added with `next-pwa`
- [ ] Vitest configured for unit and integration tests
- [ ] Playwright configured for E2E tests
- [ ] Test directories have example test files
- [ ] PWA manifest created with app metadata
- [ ] Service worker configuration added
- [ ] All test frameworks can run successfully
- [ ] Example tests pass
- [ ] Development tooling documented

## Technical Details

### Implementation Steps

**1. Configure PWA with next-pwa**

Update `next.config.js`:

```javascript
/** @type {import('next').NextConfig} */
const withPWA = require('next-pwa')({
  dest: 'public',
  disable: process.env.NODE_ENV === 'development',
  register: true,
  skipWaiting: true,
});

const nextConfig = withPWA({
  reactStrictMode: true,
  swcMinify: true,
});

module.exports = nextConfig;
```

**2. Create PWA Manifest**

Create `public/manifest.json`:

```json
{
  "name": "Korella CRM",
  "short_name": "Korella",
  "description": "Modern CRM platform for real estate professionals",
  "start_url": "/",
  "display": "standalone",
  "background_color": "#ffffff",
  "theme_color": "#0070f3",
  "orientation": "portrait-primary",
  "icons": [
    {
      "src": "/icons/icon-192x192.png",
      "sizes": "192x192",
      "type": "image/png",
      "purpose": "any maskable"
    },
    {
      "src": "/icons/icon-512x512.png",
      "sizes": "512x512",
      "type": "image/png",
      "purpose": "any maskable"
    }
  ]
}
```

**3. Link Manifest in Root Layout**

Update `app/layout.tsx` to include manifest link:

```typescript
import type { Metadata } from 'next';
import './globals.css';

export const metadata: Metadata = {
  title: 'Korella CRM',
  description: 'Modern CRM platform for real estate professionals',
  viewport: 'width=device-width, initial-scale=1, maximum-scale=5',
  themeColor: '#0070f3',
  manifest: '/manifest.json',
  appleWebApp: {
    capable: true,
    statusBarStyle: 'default',
    title: 'Korella CRM',
  },
};

export default function RootLayout({
  children,
}: {
  children: React.ReactNode;
}) {
  return (
    <html lang="en">
      <body className="min-h-screen bg-gray-50 antialiased">
        {children}
      </body>
    </html>
  );
}
```

**4. Install Vitest and Testing Libraries**

```bash
npm install -D vitest @vitejs/plugin-react @testing-library/react @testing-library/jest-dom @testing-library/user-event jsdom
```

**5. Create Vitest Configuration**

Create `vitest.config.ts`:

```typescript
import { defineConfig } from 'vitest/config';
import react from '@vitejs/plugin-react';
import path from 'path';

export default defineConfig({
  plugins: [react()],
  test: {
    environment: 'jsdom',
    globals: true,
    setupFiles: ['./tests/setup.ts'],
    include: ['tests/unit/**/*.test.{ts,tsx}', 'tests/integration/**/*.test.{ts,tsx}'],
    coverage: {
      provider: 'v8',
      reporter: ['text', 'json', 'html'],
      exclude: [
        'node_modules/',
        'tests/',
        '**/*.config.{ts,js}',
        '**/types/',
      ],
    },
  },
  resolve: {
    alias: {
      '@': path.resolve(__dirname, './'),
    },
  },
});
```

**6. Create Vitest Setup File**

Create `tests/setup.ts`:

```typescript
import '@testing-library/jest-dom';
import { expect, afterEach } from 'vitest';
import { cleanup } from '@testing-library/react';

// Cleanup after each test
afterEach(() => {
  cleanup();
});

// Custom matchers (if needed)
expect.extend({
  // Add custom matchers here
});
```

**7. Create Example Unit Test**

Create `tests/unit/lib/example.test.ts`:

```typescript
import { describe, it, expect } from 'vitest';

describe('Example Test Suite', () => {
  it('should pass basic assertion', () => {
    expect(1 + 1).toBe(2);
  });

  it('should handle strings', () => {
    expect('Korella').toContain('ore');
  });
});
```

**8. Install Playwright**

```bash
npm install -D @playwright/test
npx playwright install
```

**9. Create Playwright Configuration**

Create `playwright.config.ts`:

```typescript
import { defineConfig, devices } from '@playwright/test';

export default defineConfig({
  testDir: './tests/e2e',
  fullyParallel: true,
  forbidOnly: !!process.env.CI,
  retries: process.env.CI ? 2 : 0,
  workers: process.env.CI ? 1 : undefined,
  reporter: 'html',
  use: {
    baseURL: 'http://localhost:3000',
    trace: 'on-first-retry',
    screenshot: 'only-on-failure',
  },
  projects: [
    {
      name: 'chromium',
      use: { ...devices['Desktop Chrome'] },
    },
    {
      name: 'Mobile Chrome',
      use: { ...devices['Pixel 5'] },
    },
    {
      name: 'Mobile Safari',
      use: { ...devices['iPhone 12'] },
    },
  ],
  webServer: {
    command: 'npm run dev',
    url: 'http://localhost:3000',
    reuseExistingServer: !process.env.CI,
  },
});
```

**10. Create Example E2E Test**

Create `tests/e2e/homepage.spec.ts`:

```typescript
import { test, expect } from '@playwright/test';

test.describe('Homepage', () => {
  test('should load successfully', async ({ page }) => {
    await page.goto('/');

    // Check title
    await expect(page).toHaveTitle(/Korella CRM/);

    // Check heading is visible
    const heading = page.locator('h1');
    await expect(heading).toContainText('Korella CRM');
  });

  test('should be mobile responsive', async ({ page }) => {
    // Set mobile viewport (iPhone SE)
    await page.setViewportSize({ width: 375, height: 667 });
    await page.goto('/');

    // Should still load properly
    await expect(page.locator('h1')).toBeVisible();
  });
});
```

**11. Add Test Scripts to package.json**

Update `package.json`:

```json
{
  "scripts": {
    "dev": "next dev",
    "build": "next build",
    "start": "next start",
    "lint": "next lint",
    "test": "vitest",
    "test:ui": "vitest --ui",
    "test:coverage": "vitest run --coverage",
    "test:e2e": "playwright test",
    "test:e2e:ui": "playwright test --ui",
    "test:e2e:debug": "playwright test --debug"
  }
}
```

**12. Create .gitkeep Placeholders**

Create placeholder icon files (will be replaced with real icons later):

```bash
# Create placeholder text files
echo "Placeholder icon - replace with actual 192x192 PNG" > public/icons/icon-192x192.png.txt
echo "Placeholder icon - replace with actual 512x512 PNG" > public/icons/icon-512x512.png.txt
```

**13. Update .gitignore**

Add to `.gitignore`:

```
# Testing
coverage/
test-results/
playwright-report/

# PWA
public/sw.js
public/sw.js.map
public/workbox-*.js
public/workbox-*.js.map
```

### Key Files Created/Modified

- `next.config.js` - PWA configuration
- `public/manifest.json` - PWA manifest
- `vitest.config.ts` - Vitest configuration
- `playwright.config.ts` - Playwright configuration
- `tests/setup.ts` - Test setup file
- `tests/unit/lib/example.test.ts` - Example unit test
- `tests/e2e/homepage.spec.ts` - Example E2E test
- `package.json` - Test scripts added

## Dependencies

### Depends On
- **Task 001**: Next.js project must exist
- **Task 002**: Directory structure must be in place

### Blocks
- None (testing infrastructure ready for use in later tasks)

## Effort Estimate

- **Size**: Small (S)
- **Hours**: 1-2 hours
- **Parallel**: No (depends on 001 and 002)

## Definition of Done

- [x] PWA configured with next-pwa
- [x] Manifest.json created with correct metadata
- [x] Vitest installed and configured
- [x] Playwright installed and configured
- [x] Example unit test created and passing
- [x] Example E2E test created and passing
- [x] All test scripts work: `npm test`, `npm run test:e2e`
- [x] Coverage report can be generated: `npm run test:coverage`
- [x] Service worker generated in public/ directory
- [x] .gitignore updated for test artifacts

## Validation Commands

```bash
# Run unit tests
npm test

# Run E2E tests (requires dev server running)
npm run test:e2e

# Generate coverage report
npm run test:coverage

# Check Playwright installation
npx playwright --version

# Verify PWA service worker generated
npm run build
ls -la public/sw.js

# Run linting
npm run lint
```

## Troubleshooting

**Issue**: Vitest cannot find modules

**Solution**:
```bash
# Verify path alias in vitest.config.ts
# Should match tsconfig.json paths
```

**Issue**: Playwright tests fail to start dev server

**Solution**:
```bash
# Kill existing dev server
npx kill-port 3000

# Manually test dev server first
npm run dev
# Then run Playwright
npm run test:e2e
```

**Issue**: PWA service worker not generated

**Solution**:
```bash
# Service worker only generated in production build
npm run build
ls -la public/sw.js
```

**Issue**: Test coverage shows 0%

**Solution**:
- Need to write tests for actual code (not just examples)
- Coverage only for implemented features (comes later)

## Next Steps

After completing this task:
1. Mark task as complete
2. Foundation phase complete (Tasks 001-003)
3. Proceed to Task 004 (Supabase database setup)
4. Testing infrastructure ready for User Authentication epic
